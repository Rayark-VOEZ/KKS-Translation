# KKS-Translation

 恋活2中文粉丝翻译项目，README中还有部分内容没有翻译，有能力的可以帮忙翻译一下。

## 目录

* [前置插件](#前置插件)
* [翻译安装](#翻译安装)
* [参与翻译](#参与翻译)
* [文本翻译](#文本翻译)
* [资源翻译](#资源翻译)
* [常见问题](#常见问题)

## 前置插件

- [BepInEx 5.4.x+](https://github.com/BepInEx/BepInEx/releases/)
- [BepisPlugin for KKS](https://github.com/bbepis/BepisPlugins/releases)
- [XUnity.AutoTranslator](https://github.com/bbepis/XUnity.AutoTranslator)
- [KKS_TextResourceRedirector](https://github.com/IllusionMods/TranslationTools#textresourceredirector)
- [KKS_KKS_Subtitles](https://github.com/IllusionMods/KK_Plugins#subtitles)

## 翻译安装

1. 确保已安装所有前置插件。
2. 前往[发布页面](https://github.com/Rayark-VOEZ/KKS-Translation/releases)并下载最新的版本。同时，进阶用户可以点击`code`按钮，并在下拉菜单中点击`Download Zip`下载最新的测试版翻译。
3. 解压zip文件并移动到你游戏目录下的BepInEx文件夹(游戏可执行文件所在的文件夹)。

## 参与翻译

这里有成千上万行独立的文本需要翻译，任何帮助都非常感激。不管你的翻译技巧和日语知识如何，你仍然可以帮助翻译。即使你没有经验，你也可以通过机器翻译（如百度翻译或DeepL）提供帮助。如果使用机器翻译的情况下，需要一点逻辑来整理翻译。  

- `Text` - 普通文本替换和修改。
- `Texture` - 图像替换。

### 基本操作和结构

每一行翻译都如下所示。  
```
日文原文=中文译文
```  
示例：
```
比嘉 ひかり=比嘉 光
```
以`//`开头的行被视为注释，在翻译中不需要考虑它们。  

所有的翻译文件都在`BepInEx/Translation/zh-CN`文件夹下。它们拆分为以下目录：  
- `RedirectedResources` - 替换游戏文件中嵌入的文本。这些翻译仅在游戏需要相应文件时加载，为了准确性和性能,因此最好使用此目录而不是`Text`目录。该目录模仿游戏的结构，为每个资源文件（如`.unity3d`文件）放置一个文件夹。  
- `Text` - 游戏打开时加载的通用翻译。 所有未在`RedirectedResources`中翻译的文本都将签入此目录。 如果这里没有翻译，则未翻译的原始文本将显示在游戏中，调用Google Translator，翻译文本将写入`_AutoGeneratedTranslations.txt`，只有这样翻译才会显示在游戏中。此文件夹中的文本可以用正则表达式（Regex）处理，调整大小，并按游戏场景分隔，而不是按文件分隔。 由于这些特性，此目录通常用于用户界面（UI）。  
- `Text\Localizations` - 此文件夹下的字符串已通过TextDump转储。可以为丢失的条目添加翻译，但不应添加新条目，否则合并将来的转储将变得困难。   
- `Texture` - 包含游戏图像的翻译版本。使用图像编辑软件翻译游戏图像。如果可用，可以在项目的`Image Source Files`文件夹中找到源文件（`.psd`、`.xcf`等）。

### 修改AutoTranslator配置文件

进行翻译工作时，应在`AutoTranslatorConfig.ini`中调整以下设置。  
在`[Behaviour]`下：
- `HandleRichText` - 在处理翻译时，必须将其设置为False。 启用此功能后，当遇到未翻译的文本时，会给最终用户提供更好的体验，但会使其更难看到需要翻译的内容。
- `EnableTextPathLogging` - 设置为True可查看哪些控件设置为哪些文本以及在哪些范围级别。
- `EnableTranslationHelper` - 设置为True可以看到从哪个文件加载翻译

### 如何添加或改进翻译

- 如果您想进行简单的修改，只需打开有问题的文件并单击编辑即可。完成编辑后，提交更改并启动pull request。
- 如果您有大量的翻译要提交，请[fork存储库](https://docs.github.com/cn/get-started/quickstart/fork-a-repo)。这将在您的帐户中创建原始项目的副本。然后上传你的更改到您账户的fork中，然后向原始项目发送pull request。您的pull request将在质量检查后被审查和接受。同时，避免原始机器翻译。必须保证正确的标点和拼写。

## 文本翻译

未在`RedirectedResources`中翻译的文本使用`Text`目录。在该目录中，每次找到同一文本时，都会使用为给定文本找到的第一个翻译。但有时，同一个单词可能会有不同的含义，这取决于您在游戏中的位置，在这种情况下，您可以使用“范围等级”功能来确定在游戏的该部分应该使用哪种翻译。

### 范围等级

要使用范围级别，请使用以下结构：
```
#set level xxx
日文原文=中文译文
日文原文2=中文译文2
#unset level xxx
```
“xxx”表示所需范围级别的编号。下表包含已知范围级别及其位置：

#### 已知范围等级

|Level|描述|备注|
|---|---|---|
|-1|全局|
|1|全局扩展|
|3|角色制作器|
|4|主菜单|
|6|主要游戏UI|
|8|H场景菜单|
|9|H场景位置|
|11|自由H菜单|
|13|涂油小游戏|
|14|ADV对话|
|15|角色上传器|
|16|角色下载器|
|-1024|教程|需要
`TextResourceRedirector`插件|

## 资源翻译

`RedirectedResource`文件夹是游戏的主要翻译文件夹，所以需要特别对待。 
 
在每个文件夹中都有一个名为`translation.txt`的文件，这是翻译所在的文件。
  
每个`translation.txt`文件都有需要翻译的日文文本。每行文本在开始都被注释，所以它不会被加载。为了文本在游戏中能正确显示，请将翻译放在等号右侧，并删除开头的`//`。不要编辑日文文本，否则翻译将不起作用。示例：
  
翻译前：
```
//比嘉 ひかり=
```
翻译后：
```
//比嘉 ひかり=比嘉 光
```

`Bepinex\Translation\en\RedirectedResources`中的`assets`文件夹可以压缩到.zip存档中，供游戏读取（只需右键单击资产文件夹，然后压缩到.zip）。`assets`下的未压缩文件也将被加载。必须重新启动游戏才能看到更新的翻译。
  
这些翻译需要`TextResourceRedirector`插件。

### RedirectedResource目录结构

|文件夹|描述|
|---|---|
|`action/list/clubinfo`|入住目的|
|`action/list/monologue`|独白|
|`action/list/prayinfo`|祈祷|
|`action/list/shopinfo`|商店|
|`action/list/topic`|话题|
|`action/list/sound/se/env`|环境音效|
|`action/list/sound/se/footstep`|脚步音效|
|`action/list/wherelive`||
|`adv/scenario`||
|`communication/*/communication_*`|女主对话|
|`communication/*/communicationnpc_*`|NPC对话|
|`communication/*/optiondisplayitems_*`|对话选项|
|`communication/*/tips_*`|提示对话|
|`communication/*/topiclisten_*`|聆听对话|
|`communication/*/topicpersonalitygroup_*`|
|`communication/*/topictalkcommon*`|话题对话|
|`communication/*/topictalkrare*`|话题对话|
|`custom/customscenelist`||
|`esthetic/list/voice`|美容字幕|
|`etcetra/list/config`|个性名称|
|`etcetra/list/nickname`|昵称|
|`h/list/*/animationinfo_*`||
|`h/list/*/personality_voice*`|H字幕|
|`h/list/*/result_topic*`||
|`list/characustom`||
|`list/random_namr`|随机姓名|
|`list/mapinfo`|地图名称|
|`list/mapthumbnailinfo`|地图名称（保存/加载）|

### 个性

#### 角色个性  

|ID|日文|中文|
|---|---|---|
|00|セクシー|性感|
|01|お嬢様|大小姐|
|02|高飛車|强横|
|03|後輩キャラ|后辈|
|04|ミステリアス|神秘|
|05|電波|妄想|
|06|大和撫子|大和抚子|
|07|ボーイッシュ|假小子|
|08|純真無垢|纯真无邪|
|09|単純|单纯|
|10|邪気眼|中二病|
|11|母性的||
|12|姉御肌|御姐|
|13|ギャル||
|14|不良少女|不良少女|
|15|野生的||
|16|意識高いクール||
|17|ひねくれ||
|18|不幸少女||
|19|文学少女||
|20|モジモジ||
|21|正統派ヒロイン||
|22|ミーハー||
|23|オタク女子||
|24|ヤンデレ||
|25|ものぐさ||
|26|無口|沉默寡言|
|27|意地っ張り||
|28|のじゃっ子||
|29|素直クール||
|30|気さく||
|31|勝ち気|
|32|誠実|诚实|
|33|艶やか||
|34|帰国子女|归国子女|
|35|方言娘||
|36|Sッ気||
|37|無感情|无感情|
|38|几帳面|严格|
|39|島っ娘||
|40|高潔|高洁|
|41|ボクっ娘||
|42|天真爛漫||
|43|ノリノリ||

#### 个性资产路径

|类型|路径（将##替换为上表中的ID）|
|---|---|
|对话(ADV)|`adv/scenario/c##/*`|
|对话(交流)|`communication/info_*/*_##`|
|昵称|`etcetra/list/nickname/*/c##`|
|H字幕|`h/list/*/personalitypersonality_voice_c##_*`|

### 特殊翻译

一些由资源重定向处理的专用资源需要一些额外的处理。

#### 格式串

被String.Format处理的格式串中会出现替换项。被游戏引擎替换的部分看起来像{0}、{1}、{2}等。通常他们是角色名称或某个物品的名称。在原始字符串中找到的替换项应在翻译后字符串的相应位置。

示例：
```
本日残り{0}回=今日剩余{0}次
```
#### 可选前缀

有许多资产支持使用可选前缀以获得更精确的匹配。这允许在多个资产可能匹配相同替换代码的情况下进行更具体的翻译。匹配这些资产将首先尝试前缀匹配，然后返回到标准的无前缀匹配。

## 常见问题